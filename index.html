<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>新世代世紀館-公告</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="src/css/swiper-bundle.min.css"/>
  <link rel="stylesheet" href="src/css/style.css">
</head>
<body class="relative font-inter antialiased">
<main id="app" style="background-image: url('src/images/background/bg-2.jpg')">
  <div class="container">
    <section class="bulletin">
      <div class="swiper mySwiper">
          <div class="swiper-wrapper" id="bulletin-slide"></div>
          <div class="swiper-pagination"></div>
      </div>      
    </section>
    <section class="clock">
      <div></div>
    </section>
    <section class="calendar">
      <div></div>
    </section>
    <section class="weather">
      <div></div>
    </section>
  </div>
</main>
<script src="src/js/swiper-bundle.min.js"></script>
<script src="src/js/sparticles.js"></script>
<script src="src/js/dat.gui.min.js"></script>
<script src="src/js/Stats.min.js"></script>
<script src="src/js/sparticles-set.js"></script>
<script>

const handleBulletin = (data) => {
  const el = document.querySelector('#bulletin-slide');
  let html = '';
  data.forEach((item) => {
    html += `
      <div class="swiper-slide">
        <img src="data/announcement/${item.name}" alt="">
      </div>
    `
  })
  el.innerHTML = html;
}

function fetchJSONData() {
    fetch("data/announcement/announcements.json")
        .then((res) => {
            if (!res.ok) {
                throw new Error
                    (`HTTP error! Status: ${res.status}`);
            }
            return res.json();
        }).then((data) => {
            handleBulletin(data.data)
            console.log(data)                  
        }).then((data) => {
          var swiper = new Swiper(".mySwiper", {
            // navigation: {
            //     nextEl: ".swiper-button-next",
            //     prevEl: ".swiper-button-prev",
            // },
            pagination: {
                el: ".swiper-pagination",
                clickable: true,
                renderBullet: function (index, className) {
                  return '<span class="' + className + '">' + (index + 1) + "</span>";
                },
            },
            autoplay: {
              delay: 6000,
            },
          });
        }).catch((error) => 
          console.error("Unable to fetch data:", error));
};

fetchJSONData();
setInterval(fetchJSONData, 300000);
        
let index = 1;
function replaceImage(){
    const app = document.getElementById('app');
    index = index < 5 ? index + 1 : 1;
    app.style.backgroundImage = `url('src/images/background/bg-${index}.jpg')`;
}
setInterval(replaceImage, 600000);

// 背景圖預先載入
const imgPreloadArr = [];
(() => {
  for (let i = 1; i <= 5; i++) { 
    const img = new Image();
    img.src = `src/images/background/bg-${i}.jpg`;
    imgPreloadArr.push(img);
  }
})();

</script>
</body>
</html>